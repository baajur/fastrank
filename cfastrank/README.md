# cfastrank

Don't use this package directly, consider [``fastrank``](https://pypi.org/project/fastrank/) instead.

## The C API: (considered private)

If you'd like to bind FastRank to a language other than Python, this is roughly the right place. You'll have to build the code from source, and then see ``target/cfastrank.h`` which is autogenerated by cbindgen.

The header declares the opaque types:
```c
typedef struct CDataset CDataset;
typedef struct CModel CModel;
typedef struct CQRel CQRel;
```

Most methods return a ``CResult`` which is an error string or a success object.
```c
typedef struct {
  const void *error_message;
  const void *success;
} CResult;
```

As of 12 Oct. 2019, the API looks like:
```c
const CResult *cqrel_from_json(const void *json_str);
const void *cqrel_query_json(const CQRel *cqrel, const void *query_str);
const CResult *dataset_feature_sampling(CDataset *dataset, const void *feature_json_list);
const void *dataset_query_json(void *dataset, void *json_cmd_str);
const CResult *dataset_query_sampling(CDataset *dataset, const void *queries_json_list);
/**
 * returns json of qid->score for evaluator; or error-json.
 */
const void *evaluate_by_query(const CModel *model,
                              const CDataset *dataset,
                              const CQRel *qrel,
                              const void *evaluator);
/**
 * Note: not-recursive. Free Error Message Manually!
 */
void free_c_result(CResult *originally_from_rust);
void free_cqrel(CQRel *originally_from_rust);
void free_dataset(CDataset *originally_from_rust);
void free_model(CModel *originally_from_rust);
void free_str(void *originally_from_rust);

const CResult *load_cqrel(const void *data_path);
const CResult *load_ranksvm_format(void *data_path, void *feature_names_path);

/**
 * Make a CDataset from numpy arrays.
 */
const CResult *make_dense_dataset_f32_f64_i64(uintptr_t n,
                                              uintptr_t d,
                                              const float *x,
                                              const double *y,
                                              const int64_t *qids);

const CResult *model_from_json(const void *json_str);
const void *model_query_json(const void *model, const void *json_cmd_str);
const void *predict_to_trecrun(const CModel *model,
                               const CDataset *dataset,
                               const void *output_path,
                               const void *system_name,
                               uintptr_t depth);
const void *query_json(const void *json_cmd_str);
const CResult *train_model(void *train_request_json, void *dataset);
```

But build the header for yourself -- I'm trying to keep the C API stable but if I think of a much better way of doing something, it may change without warning -- I consider the python to be the public API for this project.